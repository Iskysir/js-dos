<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Digger Example</title>
        <script src="emulators/emulators.js"></script>
        <script src="emulators-ui/emulators-ui.js"></script>
        <link rel="stylesheet" href="emulators-ui/emulators-ui.css">
        <link rel="stylesheet" href="examples.css">
    </head>

    <body>
        <div class="layout">
            <div class="controls">
                <Button onclick="javascript:start()">Start</Button>
                <Button onclick="javascript:stop()">Stop</Button>
                <Select id="impl-select">
                    <option value="dos-worker" selected>dos worker</option>
                    <option value="dos-direct">dos direct</option>
                </Select>
            </div>
            <div id="root" style="width: 100%; height: 100%;"></div>
        </div>
        <script>
         emulators.pathPrefix = "emulators/";

         let ciPromise = null;
         const layers = emulatorsUi.dom.layers(document.getElementById("root"));

         async function start() {
             stop();

             layers.showLoadingLayer();

             const implName = document.getElementById("impl-select").value;
             const bundle = await emulatorsUi.network.resolveBundle("bundles/digger.jsdos");

             if (implName === "dos-worker") {
                 ciPromise = emulators.dosWorker(bundle);
             } else {
                 ciPromise = emulators.dosDirect(bundle);
             }

             ciPromise.then((ci) => {
                 emulatorsUi.graphics.webGl(layers, ci);
                 emulatorsUi.sound.audioNode(ci);
                 emulatorsUi.controls.keyboard(layers, ci);
                 emulatorsUi.controls.nippleArrows(layers, ci);
                 layers.hideLoadingLayer();
             });
         }

         function stop() {
             if (ciPromise !== null) {
                 ciPromise.then((ci) => ci.exit());
             }
         }
        </script>
    </body>
</html>
